<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω H·ªçc li·ªáu - Tr∆∞·ªùng Sƒ© quan Ch√≠nh tr·ªã</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>
            Qu·∫£n l√Ω H·ªçc li·ªáu Tr∆∞·ªùng Sƒ© quan Ch√≠nh tr·ªã
            <span class="header-badge">SQCT</span>
        </h1>
        <div class="user-info">
            <div class="user-profile">
                <div class="user-avatar">{{ user.full_name[0].upper() }}</div>
                <div>
                    <div style="font-weight: 600;">{{ user.full_name }}</div>
                    <div style="font-size: 12px; opacity: 0.9;">{{ user.role.value }}</div>
                </div>
            </div>
            <form method="POST" action="/api/logout" style="margin: 0;">
                <button type="submit" class="btn-logout">ƒêƒÉng xu·∫•t</button>
            </form>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Menu ch√≠nh</h2>
            <p>ƒêi·ªÅu h∆∞·ªõng h·ªá th·ªëng</p>
        </div>
        <div class="department-list">
            <a href="/dashboard" class="department-item" style="text-decoration: none; color: inherit;">
                <span class="department-code">üìä</span>
                <span class="department-name">Dashboard</span>
            </a>
            <a href="/materials" class="department-item active" style="text-decoration: none; color: inherit;">
                <span class="department-code">üìö</span>
                <span class="department-name">Qu·∫£n l√Ω H·ªçc li·ªáu</span>
            </a>
            <a href="/statistics" class="department-item" style="text-decoration: none; color: inherit;">
                <span class="department-code">üìà</span>
                <span class="department-name">Th·ªëng k√™</span>
            </a>
        </div>
        <div class="sidebar-header" style="margin-top: 0;">
            <h2>Danh m·ª•c Khoa</h2>
            <p>Ch·ªçn khoa ƒë·ªÉ xem h·ªçc li·ªáu</p>
        </div>
        <div class="department-list" id="departmentList">
            <!-- Departments will be loaded by JavaScript -->
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-header">
            <h2>H·ªçc li·ªáu</h2>
            <div style="display: flex; gap: 10px;">
                {% if user.role.value == 'admin' %}
                <button class="btn-primary" onclick="showUserManagement()">
                    üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng
                </button>
                {% endif %}
                {% if user.role.value in ['superuser', 'admin'] %}
                <button class="btn-primary" onclick="showUploadModal()">
                    ‚ûï ƒêƒÉng h·ªçc li·ªáu m·ªõi
                </button>
                {% endif %}
            </div>
        </div>

        <!-- Filter Toggle Button -->
        <div class="filter-toggle-container">
            <button class="btn-filter-toggle" onclick="toggleFilter()">
                <span id="filterToggleIcon">‚ñº</span> B·ªô l·ªçc t√¨m ki·∫øm
            </button>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar" id="filterBar">
            <div class="filter-group">
                <label for="filterSearch">T√¨m ki·∫øm</label>
                <input type="text" id="filterSearch" placeholder="T√¨m theo ti√™u ƒë·ªÅ, m√¥n h·ªçc, ch·ªß ƒë·ªÅ...">
            </div>
            <div class="filter-group">
                <label for="filterUploader">Ng∆∞·ªùi ƒëƒÉng</label>
                <input type="text" id="filterUploader" placeholder="T√¨m theo t√™n ng∆∞·ªùi ƒëƒÉng...">
            </div>
            <div class="filter-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="searchContent" onchange="toggleContentSearch()">
                    <span>T√¨m ki·∫øm theo n·ªôi dung file</span>
                </label>
                <small style="color: #666; font-size: 12px;">‚ö†Ô∏è T√¨m ki·∫øm theo n·ªôi dung c√≥ th·ªÉ m·∫•t nhi·ªÅu th·ªùi gian h∆°n</small>
            </div>
        </div>

        <!-- Column Visibility Controls -->
        <div class="column-controls">
            <button class="btn-column-toggle" onclick="toggleColumnControls()">
                ‚öôÔ∏è T√πy ch·ªânh c·ªôt hi·ªÉn th·ªã
            </button>
            <button class="btn-column-toggle" onclick="toggleColumnFilters()" style="margin-left: 10px; background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">
                üîΩ ·∫®n/Hi·ªán b·ªô l·ªçc
            </button>
            <button class="btn-column-toggle" onclick="resetColumnFilters()" style="margin-left: 10px; background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);">
                üîÑ Reset b·ªô l·ªçc
            </button>
            <div class="column-checkboxes" id="columnCheckboxes" style="display: none;">
                <label><input type="checkbox" checked onchange="toggleColumn('col-stt')" id="toggle-stt"> STT</label>
                <label><input type="checkbox" checked onchange="toggleColumn('col-title')" id="toggle-title"> Ti√™u ƒë·ªÅ</label>
                <label><input type="checkbox" checked onchange="toggleColumn('col-subject')" id="toggle-subject"> M√¥n h·ªçc</label>
                <label><input type="checkbox" checked onchange="toggleColumn('col-topic')" id="toggle-topic"> Ch·ªß ƒë·ªÅ</label>
                <label><input type="checkbox" checked onchange="toggleColumn('col-files')" id="toggle-files"> S·ªë file</label>
                <label><input type="checkbox" checked onchange="toggleColumn('col-uploader')" id="toggle-uploader"> Ng∆∞·ªùi ƒëƒÉng</label>
                <label><input type="checkbox" checked onchange="toggleColumn('col-date')" id="toggle-date"> Ng√†y ƒëƒÉng</label>
            </div>
        </div>

        <!-- Materials Table -->
        <div class="materials-table-container" id="materialsTableContainer">
            <table class="materials-table">
                <thead>
                    <tr>
                        <th class="col-stt" style="width: 50px;">
                            STT
                        </th>
                        <th class="col-title" style="width: 40%;">
                            Ti√™u ƒë·ªÅ
                        </th>
                        <th class="col-subject">
                            M√¥n h·ªçc
                            <select class="column-filter filter-dropdown" id="filterSubject" onchange="filterByColumn('subject', this.value)">
                                <option value="">-- T·∫•t c·∫£ --</option>
                            </select>
                        </th>
                        <th class="col-topic">
                            Ch·ªß ƒë·ªÅ
                            <select class="column-filter filter-dropdown" id="filterTopic" onchange="filterByColumn('topic', this.value)">
                                <option value="">-- T·∫•t c·∫£ --</option>
                            </select>
                        </th>
                        <th class="col-files">S·ªë file</th>
                        <th class="col-uploader">
                            Ng∆∞·ªùi ƒëƒÉng
                            <select class="column-filter filter-dropdown" id="filterUploaderSelect" onchange="filterByColumn('uploader', this.value)">
                                <option value="">-- T·∫•t c·∫£ --</option>
                            </select>
                        </th>
                        <th class="col-date">
                            Ng√†y ƒëƒÉng
                            <div style="margin-top: 8px;">
                                <input type="date" class="column-filter-date filter-dropdown" id="filterDateFrom" onchange="filterByDateRange()" placeholder="T·ª´ ng√†y">
                                <input type="date" class="column-filter-date filter-dropdown" id="filterDateTo" onchange="filterByDateRange()" placeholder="ƒê·∫øn ng√†y" style="margin-top: 4px;">
                            </div>
                        </th>
                        <th style="width: 160px;">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="materialsTableBody">
                    <!-- Materials will be loaded by JavaScript -->
                </tbody>
            </table>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <div class="footer-section">
                    <h3>ƒê∆°n v·ªã ph√°t tri·ªÉn</h3>
                    <p>B·ªô m√¥n KHTN - Khoa VƒÉn h√≥a Ngo·∫°i ng·ªØ</p>
                    <p>Ban CNTT - Ph√≤ng Tham m∆∞u H√†nh ch√≠nh</p>
                    <p>Tr∆∞·ªùng Sƒ© quan Ch√≠nh tr·ªã</p>
                </div>
                
                <div class="footer-section">
                    <h3>Th√¥ng tin li√™n h·ªá</h3>
                    <div class="contact-info">
                        <span>üë®‚Äçüíª</span>
                        <p>Ph√°t tri·ªÉn b·ªüi: <strong>Ng√¥ H·ªìng Qu√¢n</strong></p>
                    </div>
                    <div class="contact-info">
                        <span>üì±</span>
                        <p>Zalo: <a href="https://zalo.me/0972424294">0972424294</a></p>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>H·ªá th·ªëng</h3>
                    <p>H·ªá th·ªëng qu·∫£n l√Ω h·ªçc li·ªáu ƒëi·ªán t·ª≠</p>
                    <p>Phi√™n b·∫£n: 2.0.0</p>
                    <p>NƒÉm ph√°t tri·ªÉn: 2026</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 Tr∆∞·ªùng Sƒ© quan Ch√≠nh tr·ªã. Ph√°t tri·ªÉn b·ªüi Ng√¥ H·ªìng Qu√¢n - B·ªô m√¥n KHTN.</p>
            </div>
        </div>
    </footer>

    <!-- Upload Modal -->
    {% if user.role.value in ['superuser', 'admin'] %}
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ƒêƒÉng h·ªçc li·ªáu m·ªõi</h3>
                <button class="btn-close" onclick="closeModal('uploadModal')">&times;</button>
            </div>
            
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="title">Ti√™u ƒë·ªÅ <span style="color: red;">*</span></label>
                    <input type="text" id="title" name="title" required>
                </div>

                <div class="form-group">
                    <label for="subject">M√¥n h·ªçc <span style="color: red;">*</span></label>
                    <input type="text" id="subject" name="subject" required>
                </div>

                <div class="form-group">
                    <label for="topic">Ch·ªß ƒë·ªÅ</label>
                    <input type="text" id="topic" name="topic">
                </div>

                <div class="form-group">
                    <label for="department_id">Khoa <span style="color: red;">*</span></label>
                    <select id="department_id" name="department_id" required>
                        <option value="">Ch·ªçn khoa</option>
                        {% for dept in departments %}
                        <option value="{{ dept.id }}">{{ dept.code }} - {{ dept.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label>File T√†i li·ªáu</label>
                    <input type="file" name="tailieu_files" multiple 
                           accept=".pdf,.doc,.docx,.xls,.xlsx,.zip,.rar">
                    <small style="color: #666;">C√≥ th·ªÉ ch·ªçn nhi·ªÅu file</small>
                </div>

                <div class="form-group">
                    <label>File B√†i gi·∫£ng</label>
                    <input type="file" name="baigiang_files" multiple 
                           accept=".pdf,.doc,.docx,.ppt,.pptx">
                    <small style="color: #666;">C√≥ th·ªÉ ch·ªçn nhi·ªÅu file</small>
                </div>

                <div class="form-group">
                    <label>File ƒê·ªÅ c∆∞∆°ng</label>
                    <input type="file" name="decuong_files" multiple 
                           accept=".pdf,.doc,.docx">
                    <small style="color: #666;">C√≥ th·ªÉ ch·ªçn nhi·ªÅu file</small>
                </div>

                <div class="form-group">
                    <label>File Tr√¨nh chi·∫øu</label>
                    <input type="file" name="trinhchieu_files" multiple 
                           accept=".ppt,.pptx,.pdf">
                    <small style="color: #666;">C√≥ th·ªÉ ch·ªçn nhi·ªÅu file</small>
                </div>

                <p style="font-size: 13px; color: #999; margin-bottom: 15px;">
                    * Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt file ƒë·ªÉ ƒëƒÉng t·∫£i
                </p>

                <button type="submit" class="btn-submit">ƒêƒÉng t·∫£i</button>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- Edit Material Modal -->
    {% if user.role.value in ['superuser', 'admin'] %}
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ch·ªânh s·ª≠a h·ªçc li·ªáu</h3>
                <button class="btn-close" onclick="closeModal('editModal')">&times;</button>
            </div>
            
            <form id="editForm">
                <input type="hidden" id="edit_material_id">
                
                <div class="form-group">
                    <label for="edit_title">Ti√™u ƒë·ªÅ <span style="color: red;">*</span></label>
                    <input type="text" id="edit_title" name="title" required>
                </div>

                <div class="form-group">
                    <label for="edit_subject">M√¥n h·ªçc <span style="color: red;">*</span></label>
                    <input type="text" id="edit_subject" name="subject" required>
                </div>

                <div class="form-group">
                    <label for="edit_topic">Ch·ªß ƒë·ªÅ</label>
                    <input type="text" id="edit_topic" name="topic">
                </div>

                <div class="form-group">
                    <label for="edit_department_id">Khoa <span style="color: red;">*</span></label>
                    <select id="edit_department_id" name="department_id" required>
                        <option value="">Ch·ªçn khoa</option>
                        {% for dept in departments %}
                        <option value="{{ dept.id }}">{{ dept.code }} - {{ dept.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                    ‚ÑπÔ∏è Ch·ªâ c√≥ th·ªÉ ch·ªânh s·ª≠a th√¥ng tin, kh√¥ng th·ªÉ thay ƒë·ªïi file ƒë√≠nh k√®m.
                </p>

                <button type="submit" class="btn-submit">C·∫≠p nh·∫≠t</button>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- User Management Modal (Admin only) -->
    {% if user.role.value == 'admin' %}
    <div class="modal" id="userManagementModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h3>
                <button class="btn-close" onclick="closeModal('userManagementModal')">&times;</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <button class="btn-primary" onclick="showCreateUserModal()">‚ûï Th√™m ng∆∞·ªùi d√πng</button>
            </div>
            
            <div class="users-table" id="usersTable">
                <!-- Users will be loaded by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal" id="createUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Th√™m ng∆∞·ªùi d√πng m·ªõi</h3>
                <button class="btn-close" onclick="closeModal('createUserModal')">&times;</button>
            </div>
            
            <form id="createUserForm">
                <div class="form-group">
                    <label for="new_username">T√™n ƒëƒÉng nh·∫≠p <span style="color: red;">*</span></label>
                    <input type="text" id="new_username" name="username" required>
                </div>

                <div class="form-group">
                    <label for="new_email">Email <span style="color: red;">*</span></label>
                    <input type="email" id="new_email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="new_full_name">H·ªç v√† t√™n <span style="color: red;">*</span></label>
                    <input type="text" id="new_full_name" name="full_name" required>
                </div>

                <div class="form-group">
                    <label for="new_password">M·∫≠t kh·∫©u <span style="color: red;">*</span></label>
                    <input type="password" id="new_password" name="password" required>
                </div>

                <div class="form-group">
                    <label for="new_role">Quy·ªÅn <span style="color: red;">*</span></label>
                    <select id="new_role" name="role" required>
                        <option value="user">User (Ng∆∞·ªùi xem)</option>
                        <option value="superuser">Superuser (Ng∆∞·ªùi ƒëƒÉng)</option>
                        <option value="admin">Admin (Qu·∫£n tr·ªã vi√™n)</option>
                    </select>
                </div>

                <button type="submit" class="btn-submit">T·∫°o ng∆∞·ªùi d√πng</button>
            </form>
        </div>
    </div>
    {% endif %}

    <script>
        const currentUserRole = "{{ user.role.value }}";
        const currentUserId = {{ user.id }};
    </script>
    <script src="/static/js/main.js"></script>
</body>
</html>
