<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thá»‘ng kÃª - Quáº£n lÃ½ Há»c liá»‡u</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>
            Quáº£n lÃ½ Há»c liá»‡u TrÆ°á»ng SÄ© quan ChÃ­nh trá»‹
            <span class="header-badge">SQCT</span>
        </h1>
        <div class="user-info">
            <div class="user-profile">
                <div class="user-avatar">{{ user.full_name[0].upper() }}</div>
                <div>
                    <div style="font-weight: 600;">{{ user.full_name }}</div>
                    <div style="font-size: 12px; opacity: 0.9;">{{ user.role.value }}</div>
                </div>
            </div>
            <form method="POST" action="/api/logout" style="margin: 0;">
                <button type="submit" class="btn-logout">ÄÄƒng xuáº¥t</button>
            </form>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Menu chÃ­nh</h2>
            <p>Äiá»u hÆ°á»›ng há»‡ thá»‘ng</p>
        </div>
        <div class="department-list">
            <a href="/dashboard" class="department-item" style="text-decoration: none; color: inherit;">
                <span class="department-code">ğŸ“Š</span>
                <span class="department-name">Dashboard</span>
            </a>
            <a href="/materials" class="department-item" style="text-decoration: none; color: inherit;">
                <span class="department-code">ğŸ“š</span>
                <span class="department-name">Quáº£n lÃ½ Há»c liá»‡u</span>
            </a>
            <a href="/statistics" class="department-item active" style="text-decoration: none; color: inherit;">
                <span class="department-code">ğŸ“ˆ</span>
                <span class="department-name">Thá»‘ng kÃª</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-header">
            <h2>ğŸ“ˆ Thá»‘ng kÃª Há»c liá»‡u</h2>
        </div>

        <!-- View Selector -->
        <div class="stats-view-selector">
            <button class="view-btn active" id="overallViewBtn" onclick="switchView('overall')">
                ğŸŒ Tá»•ng quan há»‡ thá»‘ng
            </button>
            <button class="view-btn" id="deptViewBtn" onclick="switchView('department')">
                ğŸ« Theo khoa
            </button>
        </div>

        <!-- Overall Statistics View -->
        <div id="overallView" class="stats-view active">
            <div class="stats-summary">
                <div class="stat-card stat-card-primary">
                    <div class="stat-icon">ğŸ“š</div>
                    <div class="stat-info">
                        <h3 id="overallTotalMaterials">0</h3>
                        <p>Tá»•ng sá»‘ há»c liá»‡u</p>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-container">
                <div class="chart-card">
                    <h3>ğŸ“Š So sÃ¡nh há»c liá»‡u giá»¯a cÃ¡c khoa</h3>
                    <canvas id="deptComparisonChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3>ğŸ“ˆ Xu hÆ°á»›ng tÄƒng trÆ°á»Ÿng (12 thÃ¡ng gáº§n nháº¥t)</h3>
                    <canvas id="growthTrendChart"></canvas>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-card">
                    <h3>ğŸ“ PhÃ¢n loáº¡i theo loáº¡i file</h3>
                    <canvas id="overallFileTypesChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3>ğŸ‘‘ Top 10 ngÆ°á»i Ä‘Äƒng nhiá»u nháº¥t</h3>
                    <canvas id="overallTopUploadersChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Department Statistics View -->
        <div id="departmentView" class="stats-view" style="display: none;">
            <!-- Department Selector -->
            <div class="dept-selector-container">
                <label for="deptSelector">Chá»n khoa:</label>
                <select id="deptSelector" onchange="loadDepartmentStats()">
                    <option value="">-- Chá»n khoa --</option>
                    {% for dept in departments %}
                    <option value="{{ dept.id }}">{{ dept.code }} - {{ dept.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div id="deptStatsContent" style="display: none;">
                <div class="stats-summary">
                    <div class="stat-card stat-card-info">
                        <div class="stat-icon">ğŸ«</div>
                        <div class="stat-info">
                            <h3 id="deptName">-</h3>
                            <p>TÃªn khoa</p>
                        </div>
                    </div>

                    <div class="stat-card stat-card-primary">
                        <div class="stat-icon">ğŸ“š</div>
                        <div class="stat-info">
                            <h3 id="deptTotalMaterials">0</h3>
                            <p>Tá»•ng sá»‘ há»c liá»‡u</p>
                        </div>
                    </div>
                </div>

                <!-- Department Charts -->
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>ğŸ“ PhÃ¢n loáº¡i theo loáº¡i file</h3>
                        <canvas id="deptFileTypesChart"></canvas>
                    </div>

                    <div class="chart-card">
                        <h3>ğŸ“… Há»c liá»‡u theo thÃ¡ng (12 thÃ¡ng gáº§n nháº¥t)</h3>
                        <canvas id="deptMonthlyChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>ğŸ‘‘ Top 5 ngÆ°á»i Ä‘Äƒng nhiá»u nháº¥t</h3>
                    <canvas id="deptTopUploadersChart"></canvas>
                </div>
            </div>

            <div id="deptNoData" style="text-align: center; padding: 40px; color: #999;">
                Vui lÃ²ng chá»n khoa Ä‘á»ƒ xem thá»‘ng kÃª
            </div>
        </div>
    </main>

    <script src="/static/js/statistics.js"></script>
</body>
</html>
